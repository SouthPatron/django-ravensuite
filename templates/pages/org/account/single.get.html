{% extends 'layouts/member-base-full.html' %}

{% load decshift %}
{% load rely %}

{% block tpl_si_org %}{{ instance.get_org.trading_name }}{% endblock %}
{% block tpl_si_client %}{{ instance.get_client.trading_name }}{% endblock %}
{% block tpl_si_section %}Account{% endblock %}

{% block breadcrumbs %}
	{{ block.super }}
	<a href="{{ instance.get_org.get_client_list_url }}">Clients</a>&gt;
	<a href="{{ instance.get_client.get_single_url }}">{{ instance.get_client.trading_name }}</a>&gt;
	<a href="{{ instance.get_client.get_account_single_url }}">Account</a>&gt;
{% endblock %}


{% block page_functions %}
{% include 'menus/org/client_top.html' with instance=instance.get_client %}
{% endblock %}

{% block subsection_functions %}
{% include 'menus/org/account_sub.html' with instance=instance %}
{% endblock %}

{% block tpl_bl_head_inner %}
	{% rely sitekit %}
{% endblock %}


{% block tpl_bl_onready %}

	$('#account_list_table').dataTable( {
		"iDisplayLength" : 25,
		"bFilter" : false,
		"bSort" : false,
		"sPaginationType" : "full_numbers",
		"aaSortingFixed" : [[ 0, "asc" ]],
		"sDom" : 't<"bottom"ip><"clear">'
	});

	$( "#invoice-create" ).click(function() {

		invoice_list_url = OOD.URL.Invoices( 
							{{ instance.get_org.refnum }}, 
							{{ instance.get_client.refnum }}
						)
						+ '?format=json';

		$.post( invoice_list_url, function( data ) {
				window.location.href = data[ 'url' ];
			}
		);
	});

	$( "#payment-create" ).click(function() {

		payment_list_url = OOD.URL.Payments( 
							{{ instance.get_org.refnum }}, 
							{{ instance.get_client.refnum }}
						)
						+ '?format=json';

		$.post( payment_list_url, function( data ) {
				window.location.href = data[ 'url' ];
			}
		);
	});

	$( "#credit-note-create" ).click(function() {

		credit_note_list_url = OOD.URL.CreditNotes( 
							{{ instance.get_org.refnum }}, 
							{{ instance.get_client.refnum }}
						)
						+ '?format=json';

		$.post( credit_note_list_url, function( data ) {
				window.location.href = data[ 'url' ];
			}
		);
	});

	$( "#refund-create" ).click(function() {

		refund_list_url = OOD.URL.Refunds( 
							{{ instance.get_org.refnum }}, 
							{{ instance.get_client.refnum }}
						)
						+ '?format=json';

		$.post( refund_list_url, function( data ) {
				window.location.href = data[ 'url' ];
			}
		);
	});




{% endblock %}

{% block content_menu_right %}

<ul>
	<li><a href="#" id="invoice-create">New Invoice</a></li>
	<li><a href="#" id="payment-create">Receive Payment</a></li>
	<li><a href="#" id="credit-note-create">Create a Credit Note</a></li>
	<li><a href="#" id="refund-create">Create a Refund</a></li>
</ul>

{% endblock %}


{% block content %}


<div style=" font-size: 2em; margin: 20px 0px; ">
Current Balance: {{ instance.balance|decsplay }}
</div>

<div style=" font-size: 2em; margin: 20px 0px; ">
<a href="{{ instance.get_client.get_unpaid_invoice_list_url }}">Unpaid Invoices: {{ instance.get_client.get_unpaid_invoice_count }}</a>
</div>

<div style=" font-size: 2em; margin: 20px 0px; ">
<a href="{{ instance.get_client.get_unallocated_payment_list_url }}">Unallocated Payments: {{ instance.get_client.get_unallocated_payment_count }}</a>
</div>

<div style=" font-size: 2em; margin: 20px 0px; ">
<a href="{{ instance.get_client.get_unallocated_credit_note_list_url }}">Unallocated Credit Notes: {{ instance.get_client.get_unallocated_credit_note_count }}</a>
</div>

<div style=" font-size: 2em; margin: 20px 0px; ">
<a href="{{ instance.get_client.get_unallocated_refund_list_url }}">Unallocated Refunds: {{ instance.get_client.get_unallocated_refund_count }}</a>
</div>



<div style=" font-size: 2em; margin: 20px 0px; ">
{% comment %}
Unallocated Funds: {{ instance.get_client.get_unallocated_payment_amount|decsplay }}
{% endcomment %}
</div>


{% endblock %}


